{"componentChunkName":"component---src-templates-blog-post-js","path":"/posts/travis-ci-for-android/","result":{"data":{"site":{"siteMetadata":{"title":"Unicorn Utterances","siteUrl":"https://unicorn-utterances.com","disqusShortname":"unicorn-utterances","repoPath":"unicorn-utterances/unicorn-utterances","relativeToPosts":"/content/blog"}},"markdownRemark":{"id":"188d5132-d5bf-574d-b0bc-e3d1e2d2c8eb","excerpt":"Last week, I started setting up continuous integrations for some of my projects. The basic idea of a continuous integration is that you have a server to buildâ€¦","html":"<p>Last week, I started setting up continuous integrations for some of my projects. The basic idea of a continuous integration is that you have a server to build your project on a regular basis, verify that it works correctly, and deploy it to wherever your project is published. In this case, my project will be deployed to the releases of its GitHub repository and an alpha channel on the Google Play Store. In order to do this, I decided to use <a href=\"https://travis-ci.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Travis CI</a>, as it seems to be the most used and documented solution (though there are others as well). Throughout this blog, I will add small snippets of the files I am editing, but (save for the initial <code class=\"language-text\">.travis.yml</code>) never an entire file. If you get lost or would like to see a working example of this, you can find a sample project <a href=\"/redirects/?t=github&#x26;d=TravisAndroidExample\">here</a>.</p>\n<p>A small preface, make sure that you create your account on <a href=\"https://travis-ci.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">travis-ci.com</a>, not <a href=\"https://travis-ci.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">travis-ci.org</a>. Travis previously had their free plans on their .org site and only took paying customers on .com, but they have since begun <a href=\"https://docs.travis-ci.com/user/open-source-on-travis-ci-com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">migrating all of their users</a> to travis-ci.com. However, for some reason they have decided <em>not to say anything about it</em> when you create a new account, so it would be very easy to set up all of your projects on their .org site, then (X months later) realize that you have to move to .com. This isn't a huge issue, but it could be a little annoying if you have <em>almost 100 repositories</em> like I do which you would have to change (though I have only just started using Travis, so it doesn't actually affect me). Just something to note.</p>\n<h2 id=\"Step-1-Start-your-first-build\"><a href=\"#Step-1-Start-your-first-build\" aria-label=\"Step 1 Start your first build permalink\" class=\"anchor\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 36 36\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8.10021 27.8995C6.14759 25.9469 6.14759 22.7811 8.10021 20.8284L12.6964 16.2322C14.4538 14.4749 17.303 14.4749 19.0604 16.2322L20.121 17.2929C20.7068 17.8787 21.6566 17.8787 22.2423 17.2929C22.8281 16.7071 22.8281 15.7574 22.2423 15.1716L21.1817 14.1109C18.2528 11.182 13.504 11.182 10.5751 14.1109L5.97889 18.7071C2.85469 21.8313 2.85469 26.8966 5.97889 30.0208C9.10308 33.145 14.1684 33.145 17.2926 30.0208L18.3533 28.9602C18.939 28.3744 18.939 27.4246 18.3533 26.8388C17.7675 26.2531 16.8177 26.2531 16.2319 26.8388L15.1713 27.8995C13.2187 29.8521 10.0528 29.8521 8.10021 27.8995Z\" fill=\"#153E67\"/><path d=\"M27.8992 8.10051C29.8518 10.0531 29.8518 13.219 27.8992 15.1716L23.303 19.7678C21.5456 21.5251 18.6964 21.5251 16.939 19.7678L15.8784 18.7071C15.2926 18.1213 14.3428 18.1213 13.7571 18.7071C13.1713 19.2929 13.1713 20.2426 13.7571 20.8284L14.8177 21.8891C17.7467 24.818 22.4954 24.818 25.4243 21.8891L30.0205 17.2929C33.1447 14.1687 33.1447 9.10339 30.0205 5.97919C26.8963 2.855 21.831 2.855 18.7068 5.97919L17.6461 7.03985C17.0604 7.62564 17.0604 8.57539 17.6461 9.16117C18.2319 9.74696 19.1817 9.74696 19.7675 9.16117L20.8281 8.10051C22.7808 6.14789 25.9466 6.14789 27.8992 8.10051Z\" fill=\"#153E67\"/></svg></a>Step 1: Start your first build</h2>\n<p>There are a few basic things to do in order to build your project. Assuming that you have already <a href=\"https://docs.travis-ci.com/user/tutorial/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">set up your account</a> and authenticated it with your GitHub, you will next want to create a file named <code class=\"language-text\">.travis.yml</code> in your project's root directory. One thing to keep in mind here is that the YAML format in this file is heavily dependent on whitespace; tab characters are invalid, indents must be made only in spaces, and a sub-section or parameter <strong>must</strong> be indented or it will not be treated as such. To start, let's write a basic file that should properly build most up-to-date Android projects.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">language</span><span class=\"token punctuation\">:</span> android\n<span class=\"token key atrule\">android</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">components</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> tools\n    <span class=\"token punctuation\">-</span> platform<span class=\"token punctuation\">-</span>tools\n    <span class=\"token punctuation\">-</span> build<span class=\"token punctuation\">-</span>tools<span class=\"token punctuation\">-</span>28.0.3\n    <span class=\"token punctuation\">-</span> android<span class=\"token punctuation\">-</span><span class=\"token number\">28</span>\n    <span class=\"token punctuation\">-</span> extra<span class=\"token punctuation\">-</span>google<span class=\"token punctuation\">-</span>google_play_services\n    <span class=\"token punctuation\">-</span> extra<span class=\"token punctuation\">-</span>google<span class=\"token punctuation\">-</span>m2repository\n    <span class=\"token punctuation\">-</span> extra<span class=\"token punctuation\">-</span>android<span class=\"token punctuation\">-</span>m2repository\n<span class=\"token key atrule\">jdk</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> oraclejdk8\n<span class=\"token key atrule\">before_install</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> chmod +x gradlew</code></pre></div>\n<p>You will want to update the <code class=\"language-text\">android</code> and <code class=\"language-text\">build-tools</code> versions to match the respective values in your project's <code class=\"language-text\">build.gradle</code> file, and <code class=\"language-text\">extra-google-google_play_services</code> can be omitted (it will speed up build times) if you are not using it. The same goes for the <code class=\"language-text\">jdk</code>. Note the <code class=\"language-text\">before_install</code> section; statements placed there are executed before your project is built or installed (side-note: you will want to make sure <code class=\"language-text\">gradlew</code> and <code class=\"language-text\">gradle/wrapper</code> are in your version control; Travis uses them to build your project).</p>\n<p>Now, when you commit this file to your repository (the branch should not make a difference), Travis should build your project and notify you of the result.</p>\n<h2 id=\"Step-2-Signing-APKs\"><a href=\"#Step-2-Signing-APKs\" aria-label=\"Step 2 Signing APKs permalink\" class=\"anchor\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 36 36\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8.10021 27.8995C6.14759 25.9469 6.14759 22.7811 8.10021 20.8284L12.6964 16.2322C14.4538 14.4749 17.303 14.4749 19.0604 16.2322L20.121 17.2929C20.7068 17.8787 21.6566 17.8787 22.2423 17.2929C22.8281 16.7071 22.8281 15.7574 22.2423 15.1716L21.1817 14.1109C18.2528 11.182 13.504 11.182 10.5751 14.1109L5.97889 18.7071C2.85469 21.8313 2.85469 26.8966 5.97889 30.0208C9.10308 33.145 14.1684 33.145 17.2926 30.0208L18.3533 28.9602C18.939 28.3744 18.939 27.4246 18.3533 26.8388C17.7675 26.2531 16.8177 26.2531 16.2319 26.8388L15.1713 27.8995C13.2187 29.8521 10.0528 29.8521 8.10021 27.8995Z\" fill=\"#153E67\"/><path d=\"M27.8992 8.10051C29.8518 10.0531 29.8518 13.219 27.8992 15.1716L23.303 19.7678C21.5456 21.5251 18.6964 21.5251 16.939 19.7678L15.8784 18.7071C15.2926 18.1213 14.3428 18.1213 13.7571 18.7071C13.1713 19.2929 13.1713 20.2426 13.7571 20.8284L14.8177 21.8891C17.7467 24.818 22.4954 24.818 25.4243 21.8891L30.0205 17.2929C33.1447 14.1687 33.1447 9.10339 30.0205 5.97919C26.8963 2.855 21.831 2.855 18.7068 5.97919L17.6461 7.03985C17.0604 7.62564 17.0604 8.57539 17.6461 9.16117C18.2319 9.74696 19.1817 9.74696 19.7675 9.16117L20.8281 8.10051C22.7808 6.14789 25.9466 6.14789 27.8992 8.10051Z\" fill=\"#153E67\"/></svg></a>Step 2. Signing APKs</h2>\n<p>So Travis <em>can</em> successfully build your APK, but that itself is not very useful. It can do something with debug APKs, sure, but deploying them won't be very useful as they won't be under the same signature, and users won't be able to update from the existing application. So... we need a way to sign the application using an existing keystore that Travis has access to.</p>\n<blockquote>\n<p>LET'S UPLOAD OUR KEYSTORE TO GIT!</p>\n</blockquote>\n<p>Not a bad idea. This will easily give Travis the ability to sign our APK. Isn't there some reason that you shouldn't share your keystore online, though, maybe something about \"malicious developers and companies can use it to update your application without your knowledge\"? Weeeelll why don't we use Travis's built-in encryption service? This will give you an encrypted file (like <code class=\"language-text\">key.jks.enc</code>) that you can safely add to git, and add a command to the <code class=\"language-text\">before_install</code> section in your <code class=\"language-text\">.travis.yml</code> to decrypt it.</p>\n<blockquote>\n<p>But... can't someone just look in your <code class=\"language-text\">.travis.yml</code>, get the command, and use it to decrypt your file?</p>\n</blockquote>\n<p>No, they can't. This is because the values passed to the command are two <a href=\"https://docs.travis-ci.com/user/environment-variables/#defining-variables-in-repository-settings\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">environment variables</a> which are stored only on Travis. As long as you <em>don't</em> check the \"show value in log\" box when you create an environment variable, they will never be output anywhere in your build logs, and nobody will be able to see them or know what they are.</p>\n<p>If you are worried about security (or if you aren't worried enough), I highly recommend that you read <a href=\"https://docs.travis-ci.com/user/best-practices-security/#Steps-Travis-CI-takes-to-secure-your-data\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Travis's documentation</a> on best practices regarding secure data. </p>\n<h3 id=\"Part-A-Encrypting-files\"><a href=\"#Part-A-Encrypting-files\" aria-label=\"Part A Encrypting files permalink\" class=\"anchor\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 36 36\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8.10021 27.8995C6.14759 25.9469 6.14759 22.7811 8.10021 20.8284L12.6964 16.2322C14.4538 14.4749 17.303 14.4749 19.0604 16.2322L20.121 17.2929C20.7068 17.8787 21.6566 17.8787 22.2423 17.2929C22.8281 16.7071 22.8281 15.7574 22.2423 15.1716L21.1817 14.1109C18.2528 11.182 13.504 11.182 10.5751 14.1109L5.97889 18.7071C2.85469 21.8313 2.85469 26.8966 5.97889 30.0208C9.10308 33.145 14.1684 33.145 17.2926 30.0208L18.3533 28.9602C18.939 28.3744 18.939 27.4246 18.3533 26.8388C17.7675 26.2531 16.8177 26.2531 16.2319 26.8388L15.1713 27.8995C13.2187 29.8521 10.0528 29.8521 8.10021 27.8995Z\" fill=\"#153E67\"/><path d=\"M27.8992 8.10051C29.8518 10.0531 29.8518 13.219 27.8992 15.1716L23.303 19.7678C21.5456 21.5251 18.6964 21.5251 16.939 19.7678L15.8784 18.7071C15.2926 18.1213 14.3428 18.1213 13.7571 18.7071C13.1713 19.2929 13.1713 20.2426 13.7571 20.8284L14.8177 21.8891C17.7467 24.818 22.4954 24.818 25.4243 21.8891L30.0205 17.2929C33.1447 14.1687 33.1447 9.10339 30.0205 5.97919C26.8963 2.855 21.831 2.855 18.7068 5.97919L17.6461 7.03985C17.0604 7.62564 17.0604 8.57539 17.6461 9.16117C18.2319 9.74696 19.1817 9.74696 19.7675 9.16117L20.8281 8.10051C22.7808 6.14789 25.9466 6.14789 27.8992 8.10051Z\" fill=\"#153E67\"/></svg></a>Part A. Encrypting files</h3>\n<p>You can go about this two ways: a difficult way, or a difficult way. You can either install <a href=\"https://docs.travis-ci.com/user/encrypting-files/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Travis's CLI tool</a> for the sole purpose of logging in, encrypting your file, and setting its environment variables, or you can just do it yourself. I will provide instructions for both. Do what you like.</p>\n<p>Note that if you want to automatically deploy your builds to Google Play, you may want to come back here and go through the exact same process later on, so you might want to skip this for now. If you don't, or want to do it twice anyway... carry on...</p>\n<h4 id=\"Using-Traviss-CLI\"><a href=\"#Using-Traviss-CLI\" aria-label=\"Using Traviss CLI permalink\" class=\"anchor\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 36 36\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8.10021 27.8995C6.14759 25.9469 6.14759 22.7811 8.10021 20.8284L12.6964 16.2322C14.4538 14.4749 17.303 14.4749 19.0604 16.2322L20.121 17.2929C20.7068 17.8787 21.6566 17.8787 22.2423 17.2929C22.8281 16.7071 22.8281 15.7574 22.2423 15.1716L21.1817 14.1109C18.2528 11.182 13.504 11.182 10.5751 14.1109L5.97889 18.7071C2.85469 21.8313 2.85469 26.8966 5.97889 30.0208C9.10308 33.145 14.1684 33.145 17.2926 30.0208L18.3533 28.9602C18.939 28.3744 18.939 27.4246 18.3533 26.8388C17.7675 26.2531 16.8177 26.2531 16.2319 26.8388L15.1713 27.8995C13.2187 29.8521 10.0528 29.8521 8.10021 27.8995Z\" fill=\"#153E67\"/><path d=\"M27.8992 8.10051C29.8518 10.0531 29.8518 13.219 27.8992 15.1716L23.303 19.7678C21.5456 21.5251 18.6964 21.5251 16.939 19.7678L15.8784 18.7071C15.2926 18.1213 14.3428 18.1213 13.7571 18.7071C13.1713 19.2929 13.1713 20.2426 13.7571 20.8284L14.8177 21.8891C17.7467 24.818 22.4954 24.818 25.4243 21.8891L30.0205 17.2929C33.1447 14.1687 33.1447 9.10339 30.0205 5.97919C26.8963 2.855 21.831 2.855 18.7068 5.97919L17.6461 7.03985C17.0604 7.62564 17.0604 8.57539 17.6461 9.16117C18.2319 9.74696 19.1817 9.74696 19.7675 9.16117L20.8281 8.10051C22.7808 6.14789 25.9466 6.14789 27.8992 8.10051Z\" fill=\"#153E67\"/></svg></a>Using Travis's CLI</h4>\n<p>First, install it. Assuming you have Ruby set up, you'll want to run <code class=\"language-text\">gem install travis</code>. Since not everyone has Ruby set up, <a href=\"https://www.ruby-lang.org/en/documentation/installation/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here are their installation instructions</a>. A bit of a pain for something that you can just write yourself in my opinion, but hey, anything to avoid writing more code.</p>\n<p>After that, you'll want to log in. Run <code class=\"language-text\">travis login</code> and it will walk you through it. Note: (related to the preface at the start) no matter what site you are using when you use the Travis CLI, you should append either <code class=\"language-text\">--org</code> or <code class=\"language-text\">--com</code> to <strong>every command</strong> to specify which site it should use.</p>\n<p>Now, find your keystore. Place it in your root directory. The CLI detects git repos to determine what project you want to modify, so this is necessary. Do not add it to git. That is bad and not good. Don't do that.</p>\n<p>Assuming you have named your keystore <code class=\"language-text\">key.jks</code>, you will want to run <code class=\"language-text\">travis encrypt-file key.jks --add</code>. This will encrypt the file, add the command to your <code class=\"language-text\">.travis.yml</code>, and upload the environment variables all at once. You can then add <code class=\"language-text\">key.jks.enc</code> to git, commit and push, and it will be available to your next build.</p>\n<p>Side-note: if your keystore is a <code class=\"language-text\">.keystore</code> file, it shouldn't make a difference - just replace <code class=\"language-text\">key.jks</code> with <code class=\"language-text\">key.keystore</code> (or whatever it is named) whenever it appears.</p>\n<h4 id=\"Doing-It-Yourself\"><a href=\"#Doing-It-Yourself\" aria-label=\"Doing It Yourself permalink\" class=\"anchor\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 36 36\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8.10021 27.8995C6.14759 25.9469 6.14759 22.7811 8.10021 20.8284L12.6964 16.2322C14.4538 14.4749 17.303 14.4749 19.0604 16.2322L20.121 17.2929C20.7068 17.8787 21.6566 17.8787 22.2423 17.2929C22.8281 16.7071 22.8281 15.7574 22.2423 15.1716L21.1817 14.1109C18.2528 11.182 13.504 11.182 10.5751 14.1109L5.97889 18.7071C2.85469 21.8313 2.85469 26.8966 5.97889 30.0208C9.10308 33.145 14.1684 33.145 17.2926 30.0208L18.3533 28.9602C18.939 28.3744 18.939 27.4246 18.3533 26.8388C17.7675 26.2531 16.8177 26.2531 16.2319 26.8388L15.1713 27.8995C13.2187 29.8521 10.0528 29.8521 8.10021 27.8995Z\" fill=\"#153E67\"/><path d=\"M27.8992 8.10051C29.8518 10.0531 29.8518 13.219 27.8992 15.1716L23.303 19.7678C21.5456 21.5251 18.6964 21.5251 16.939 19.7678L15.8784 18.7071C15.2926 18.1213 14.3428 18.1213 13.7571 18.7071C13.1713 19.2929 13.1713 20.2426 13.7571 20.8284L14.8177 21.8891C17.7467 24.818 22.4954 24.818 25.4243 21.8891L30.0205 17.2929C33.1447 14.1687 33.1447 9.10339 30.0205 5.97919C26.8963 2.855 21.831 2.855 18.7068 5.97919L17.6461 7.03985C17.0604 7.62564 17.0604 8.57539 17.6461 9.16117C18.2319 9.74696 19.1817 9.74696 19.7675 9.16117L20.8281 8.10051C22.7808 6.14789 25.9466 6.14789 27.8992 8.10051Z\" fill=\"#153E67\"/></svg></a>Doing It Yourself</h4>\n<p>Pick a key and a password. They shouldn't be excessively long, but not tiny either. Do not use special characters. In this example, I will use \"php\" as the key and \"aaaaa\" as the password.</p>\n<p>Add them to Travis CI as environment variables. You can do this by going to your project page in Travis, clicking on \"More Options > Settings\", then scrolling down to \"Environment Variables\". I will name mine \"enc<em>keystore</em>key\" and \"enc<em>keystore</em>pass\", respectively.</p>\n<p>Now, time to encrypt the file. Run this command in the terminal:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">openssl aes-256-cbc -K <span class=\"token string\">\"php\"</span> -iv <span class=\"token string\">\"aaaaa\"</span> -in key.jks -out key.jks.enc</code></pre></div>\n<p>Now, you will want to add a line to decrypt the file in <code class=\"language-text\">before_install</code> of your <code class=\"language-text\">.travis.yml</code>. You should not pass your key/password here, as this file will be pushed to git, and that would be bad. Instead, we will reference the environment variables.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">before_install</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">...</span>\n  <span class=\"token punctuation\">-</span> openssl aes<span class=\"token punctuation\">-</span>256<span class=\"token punctuation\">-</span>cbc <span class=\"token punctuation\">-</span>K $enc_keystore_key <span class=\"token punctuation\">-</span>iv $enc_keystore_pass <span class=\"token punctuation\">-</span>in key.jks.enc <span class=\"token punctuation\">-</span>out key.jks <span class=\"token punctuation\">-</span>d</code></pre></div>\n<p>That's it! Push your changes to <code class=\"language-text\">.travis.yml</code> as well as <code class=\"language-text\">key.jks.enc</code>, and Jekyll should build your project.</p>\n<h3 id=\"Part-B-Dummy-files\"><a href=\"#Part-B-Dummy-files\" aria-label=\"Part B Dummy files permalink\" class=\"anchor\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 36 36\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8.10021 27.8995C6.14759 25.9469 6.14759 22.7811 8.10021 20.8284L12.6964 16.2322C14.4538 14.4749 17.303 14.4749 19.0604 16.2322L20.121 17.2929C20.7068 17.8787 21.6566 17.8787 22.2423 17.2929C22.8281 16.7071 22.8281 15.7574 22.2423 15.1716L21.1817 14.1109C18.2528 11.182 13.504 11.182 10.5751 14.1109L5.97889 18.7071C2.85469 21.8313 2.85469 26.8966 5.97889 30.0208C9.10308 33.145 14.1684 33.145 17.2926 30.0208L18.3533 28.9602C18.939 28.3744 18.939 27.4246 18.3533 26.8388C17.7675 26.2531 16.8177 26.2531 16.2319 26.8388L15.1713 27.8995C13.2187 29.8521 10.0528 29.8521 8.10021 27.8995Z\" fill=\"#153E67\"/><path d=\"M27.8992 8.10051C29.8518 10.0531 29.8518 13.219 27.8992 15.1716L23.303 19.7678C21.5456 21.5251 18.6964 21.5251 16.939 19.7678L15.8784 18.7071C15.2926 18.1213 14.3428 18.1213 13.7571 18.7071C13.1713 19.2929 13.1713 20.2426 13.7571 20.8284L14.8177 21.8891C17.7467 24.818 22.4954 24.818 25.4243 21.8891L30.0205 17.2929C33.1447 14.1687 33.1447 9.10339 30.0205 5.97919C26.8963 2.855 21.831 2.855 18.7068 5.97919L17.6461 7.03985C17.0604 7.62564 17.0604 8.57539 17.6461 9.16117C18.2319 9.74696 19.1817 9.74696 19.7675 9.16117L20.8281 8.10051C22.7808 6.14789 25.9466 6.14789 27.8992 8.10051Z\" fill=\"#153E67\"/></svg></a>Part B. Dummy files</h3>\n<p>This isn't entirely necessary, but you can use some fake \"dummy\" files to add to version control alongside the \"real\" encrypted ones. When Travis decrypts your encrypted files, they will be overwritten, but otherwise they serve as quite a nice substitute to prevent anyone from getting their hands on the real files (and to prevent you from uploading the real ones by accident). You can find a few (<code class=\"language-text\">key.jks</code>, <code class=\"language-text\">service.json</code>, and <code class=\"language-text\">secrets.tar</code>) in the sample project <a href=\"/redirects/?t=github&#x26;d=TravisAndroidExample\">here</a>.</p>\n<h3 id=\"Part-C-Signing-the-APK\"><a href=\"#Part-C-Signing-the-APK\" aria-label=\"Part C Signing the APK permalink\" class=\"anchor\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 36 36\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8.10021 27.8995C6.14759 25.9469 6.14759 22.7811 8.10021 20.8284L12.6964 16.2322C14.4538 14.4749 17.303 14.4749 19.0604 16.2322L20.121 17.2929C20.7068 17.8787 21.6566 17.8787 22.2423 17.2929C22.8281 16.7071 22.8281 15.7574 22.2423 15.1716L21.1817 14.1109C18.2528 11.182 13.504 11.182 10.5751 14.1109L5.97889 18.7071C2.85469 21.8313 2.85469 26.8966 5.97889 30.0208C9.10308 33.145 14.1684 33.145 17.2926 30.0208L18.3533 28.9602C18.939 28.3744 18.939 27.4246 18.3533 26.8388C17.7675 26.2531 16.8177 26.2531 16.2319 26.8388L15.1713 27.8995C13.2187 29.8521 10.0528 29.8521 8.10021 27.8995Z\" fill=\"#153E67\"/><path d=\"M27.8992 8.10051C29.8518 10.0531 29.8518 13.219 27.8992 15.1716L23.303 19.7678C21.5456 21.5251 18.6964 21.5251 16.939 19.7678L15.8784 18.7071C15.2926 18.1213 14.3428 18.1213 13.7571 18.7071C13.1713 19.2929 13.1713 20.2426 13.7571 20.8284L14.8177 21.8891C17.7467 24.818 22.4954 24.818 25.4243 21.8891L30.0205 17.2929C33.1447 14.1687 33.1447 9.10339 30.0205 5.97919C26.8963 2.855 21.831 2.855 18.7068 5.97919L17.6461 7.03985C17.0604 7.62564 17.0604 8.57539 17.6461 9.16117C18.2319 9.74696 19.1817 9.74696 19.7675 9.16117L20.8281 8.10051C22.7808 6.14789 25.9466 6.14789 27.8992 8.10051Z\" fill=\"#153E67\"/></svg></a>Part C. Signing the APK</h3>\n<p>Now we want to actually use the key to sign our APKs. This requires a few changes to our app's build.gradle. Specifically, we need to specify a <code class=\"language-text\">signingConfig</code> that ONLY exists on Travis - we don't want our local builds (or the builds of other contributors) to be affected by this. Luckily, not only can we read environment variables from our <code class=\"language-text\">build.gradle</code> file using <code class=\"language-text\">System.getenv</code>, Travis automatically creates a nice \"CI\" variable to tell us that the build is happening in a Continuous Integration, so why don't we use that.</p>\n<p>Full credit, this solution was taken from <a href=\"https://android.jlelse.eu/using-travisci-to-securely-build-and-deploy-a-signed-version-of-your-android-app-94afdf5cf5b4\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this wonderful article</a> that describes almost the same thing that I have been explaining since the start of this article.</p>\n<p>I'll create three environment variables that will be used here: the keystore password as \"keystore<em>password\", the keystore alias as \"keystore</em>alias\", and the alias's password as \"keystore<em>alias</em>password\". Note that special characters cannot be used in these either.</p>\n<div class=\"gatsby-highlight\" data-language=\"groovy\"><pre class=\"language-groovy\"><code class=\"language-groovy\">android <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">...</span>\n    signingConfigs <span class=\"token punctuation\">{</span>\n        release\n    <span class=\"token punctuation\">}</span>\n    buildTypes <span class=\"token punctuation\">{</span>\n        release <span class=\"token punctuation\">{</span>\n            <span class=\"token punctuation\">...</span>\n            signingConfig signingConfigs<span class=\"token operator\">.</span>release\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">def</span> isRunningOnTravis <span class=\"token operator\">=</span> System<span class=\"token operator\">.</span><span class=\"token function\">getenv</span><span class=\"token punctuation\">(</span><span class=\"token string gstring\">\"CI\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string gstring\">\"true\"</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isRunningOnTravis<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        signingConfigs<span class=\"token operator\">.</span>release<span class=\"token operator\">.</span>storeFile <span class=\"token operator\">=</span> <span class=\"token function\">file</span><span class=\"token punctuation\">(</span><span class=\"token string gstring\">\"../key.jks\"</span><span class=\"token punctuation\">)</span>\n        signingConfigs<span class=\"token operator\">.</span>release<span class=\"token operator\">.</span>storePassword <span class=\"token operator\">=</span> System<span class=\"token operator\">.</span><span class=\"token function\">getenv</span><span class=\"token punctuation\">(</span><span class=\"token string gstring\">\"keystore_password\"</span><span class=\"token punctuation\">)</span>\n        signingConfigs<span class=\"token operator\">.</span>release<span class=\"token operator\">.</span>keyAlias <span class=\"token operator\">=</span> System<span class=\"token operator\">.</span><span class=\"token function\">getenv</span><span class=\"token punctuation\">(</span><span class=\"token string gstring\">\"keystore_alias\"</span><span class=\"token punctuation\">)</span>\n        signingConfigs<span class=\"token operator\">.</span>release<span class=\"token operator\">.</span>keyPassword <span class=\"token operator\">=</span> System<span class=\"token operator\">.</span><span class=\"token function\">getenv</span><span class=\"token punctuation\">(</span><span class=\"token string gstring\">\"keystore_alias_password\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Of course, Travis isn't currently building a release variant (I think it defaults to <code class=\"language-text\">./gradlew build</code>), so this <code class=\"language-text\">signingConfig</code> won't be applied. We need to change that. Add the following to your <code class=\"language-text\">.travis.yml</code>...</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> ./gradlew assembleRelease</code></pre></div>\n<p>Now it will create a proper release using these signing configs. Push everything to git and it should build a properly signed APK. Yay.</p>\n<h2 id=\"Step-3-Deploying-to-github-releases\"><a href=\"#Step-3-Deploying-to-github-releases\" aria-label=\"Step 3 Deploying to github releases permalink\" class=\"anchor\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 36 36\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8.10021 27.8995C6.14759 25.9469 6.14759 22.7811 8.10021 20.8284L12.6964 16.2322C14.4538 14.4749 17.303 14.4749 19.0604 16.2322L20.121 17.2929C20.7068 17.8787 21.6566 17.8787 22.2423 17.2929C22.8281 16.7071 22.8281 15.7574 22.2423 15.1716L21.1817 14.1109C18.2528 11.182 13.504 11.182 10.5751 14.1109L5.97889 18.7071C2.85469 21.8313 2.85469 26.8966 5.97889 30.0208C9.10308 33.145 14.1684 33.145 17.2926 30.0208L18.3533 28.9602C18.939 28.3744 18.939 27.4246 18.3533 26.8388C17.7675 26.2531 16.8177 26.2531 16.2319 26.8388L15.1713 27.8995C13.2187 29.8521 10.0528 29.8521 8.10021 27.8995Z\" fill=\"#153E67\"/><path d=\"M27.8992 8.10051C29.8518 10.0531 29.8518 13.219 27.8992 15.1716L23.303 19.7678C21.5456 21.5251 18.6964 21.5251 16.939 19.7678L15.8784 18.7071C15.2926 18.1213 14.3428 18.1213 13.7571 18.7071C13.1713 19.2929 13.1713 20.2426 13.7571 20.8284L14.8177 21.8891C17.7467 24.818 22.4954 24.818 25.4243 21.8891L30.0205 17.2929C33.1447 14.1687 33.1447 9.10339 30.0205 5.97919C26.8963 2.855 21.831 2.855 18.7068 5.97919L17.6461 7.03985C17.0604 7.62564 17.0604 8.57539 17.6461 9.16117C18.2319 9.74696 19.1817 9.74696 19.7675 9.16117L20.8281 8.10051C22.7808 6.14789 25.9466 6.14789 27.8992 8.10051Z\" fill=\"#153E67\"/></svg></a>Step 3. Deploying to github releases</h2>\n<p>This part is fairly simple, as Travis provides its own deployment functionality for this purpose. According to <a href=\"https://docs.travis-ci.com/user/deployment/releases/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">their documentation</a>, for the bare minimum functionality all that you will need is to add the following to your <code class=\"language-text\">.travis.yml</code>...</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">provider</span><span class=\"token punctuation\">:</span> releases\n    <span class=\"token key atrule\">api_key</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"GITHUB OAUTH TOKEN\"</span>\n    <span class=\"token key atrule\">file</span><span class=\"token punctuation\">:</span> app/build/outputs/apk/release/*\n    <span class=\"token key atrule\">file_glob</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">skip_cleanup</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">tags</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div>\n<p>Now, you <em>could</em> follow this exactly and place your GitHub token directly in your <code class=\"language-text\">.travis.yml</code>, but that's just asking for trouble. Luckily, you can use MORE ENVIRONMENT VARIABLES! Enter your API key with the name ex. \"GITHUB<em>TOKEN\", and write `api</em>key: \"$GITHUB_TOKEN\"` instead.</p>\n<p>This should now create a release with a built (and signed) APK each time there is a new tag. Fair enough; all you have to do for it to deploy is create a new tag.</p>\n<h3 id=\"Part-A-Creating-tags\"><a href=\"#Part-A-Creating-tags\" aria-label=\"Part A Creating tags permalink\" class=\"anchor\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 36 36\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8.10021 27.8995C6.14759 25.9469 6.14759 22.7811 8.10021 20.8284L12.6964 16.2322C14.4538 14.4749 17.303 14.4749 19.0604 16.2322L20.121 17.2929C20.7068 17.8787 21.6566 17.8787 22.2423 17.2929C22.8281 16.7071 22.8281 15.7574 22.2423 15.1716L21.1817 14.1109C18.2528 11.182 13.504 11.182 10.5751 14.1109L5.97889 18.7071C2.85469 21.8313 2.85469 26.8966 5.97889 30.0208C9.10308 33.145 14.1684 33.145 17.2926 30.0208L18.3533 28.9602C18.939 28.3744 18.939 27.4246 18.3533 26.8388C17.7675 26.2531 16.8177 26.2531 16.2319 26.8388L15.1713 27.8995C13.2187 29.8521 10.0528 29.8521 8.10021 27.8995Z\" fill=\"#153E67\"/><path d=\"M27.8992 8.10051C29.8518 10.0531 29.8518 13.219 27.8992 15.1716L23.303 19.7678C21.5456 21.5251 18.6964 21.5251 16.939 19.7678L15.8784 18.7071C15.2926 18.1213 14.3428 18.1213 13.7571 18.7071C13.1713 19.2929 13.1713 20.2426 13.7571 20.8284L14.8177 21.8891C17.7467 24.818 22.4954 24.818 25.4243 21.8891L30.0205 17.2929C33.1447 14.1687 33.1447 9.10339 30.0205 5.97919C26.8963 2.855 21.831 2.855 18.7068 5.97919L17.6461 7.03985C17.0604 7.62564 17.0604 8.57539 17.6461 9.16117C18.2319 9.74696 19.1817 9.74696 19.7675 9.16117L20.8281 8.10051C22.7808 6.14789 25.9466 6.14789 27.8992 8.10051Z\" fill=\"#153E67\"/></svg></a>Part A. Creating tags</h3>\n<p>What if you're lazy like me, though? What if you want to create a new release on each push to the master branch? (I have two branches in most of my projects, <code class=\"language-text\">develop</code> and <code class=\"language-text\">master</code>, for this purpose - only the commits currently in production are in the <code class=\"language-text\">master</code> branch)</p>\n<p>A simple modification to the <code class=\"language-text\">on</code> section of the previous snippet does the trick.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">...</span>\n    <span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">branch</span><span class=\"token punctuation\">:</span> master</code></pre></div>\n<p>Well, it almost does the trick. The thing is, since we haven't created a tag, Travis doesn't know what version number we want to use. It just creates a new release using the commit hash as a title. That isn't very good. I wonder if we could somehow get the version number from our build.gradle file and use that instead...</p>\n<h3 id=\"Part-B-Version-numbers\"><a href=\"#Part-B-Version-numbers\" aria-label=\"Part B Version numbers permalink\" class=\"anchor\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 36 36\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8.10021 27.8995C6.14759 25.9469 6.14759 22.7811 8.10021 20.8284L12.6964 16.2322C14.4538 14.4749 17.303 14.4749 19.0604 16.2322L20.121 17.2929C20.7068 17.8787 21.6566 17.8787 22.2423 17.2929C22.8281 16.7071 22.8281 15.7574 22.2423 15.1716L21.1817 14.1109C18.2528 11.182 13.504 11.182 10.5751 14.1109L5.97889 18.7071C2.85469 21.8313 2.85469 26.8966 5.97889 30.0208C9.10308 33.145 14.1684 33.145 17.2926 30.0208L18.3533 28.9602C18.939 28.3744 18.939 27.4246 18.3533 26.8388C17.7675 26.2531 16.8177 26.2531 16.2319 26.8388L15.1713 27.8995C13.2187 29.8521 10.0528 29.8521 8.10021 27.8995Z\" fill=\"#153E67\"/><path d=\"M27.8992 8.10051C29.8518 10.0531 29.8518 13.219 27.8992 15.1716L23.303 19.7678C21.5456 21.5251 18.6964 21.5251 16.939 19.7678L15.8784 18.7071C15.2926 18.1213 14.3428 18.1213 13.7571 18.7071C13.1713 19.2929 13.1713 20.2426 13.7571 20.8284L14.8177 21.8891C17.7467 24.818 22.4954 24.818 25.4243 21.8891L30.0205 17.2929C33.1447 14.1687 33.1447 9.10339 30.0205 5.97919C26.8963 2.855 21.831 2.855 18.7068 5.97919L17.6461 7.03985C17.0604 7.62564 17.0604 8.57539 17.6461 9.16117C18.2319 9.74696 19.1817 9.74696 19.7675 9.16117L20.8281 8.10051C22.7808 6.14789 25.9466 6.14789 27.8992 8.10051Z\" fill=\"#153E67\"/></svg></a>Part B. Version numbers</h3>\n<p>Let's write a gradle task to print our version number! Place the following in your app's <code class=\"language-text\">build.gradle</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"groovy\"><pre class=\"language-groovy\"><code class=\"language-groovy\">task printVersionName <span class=\"token punctuation\">{</span>\n    doLast <span class=\"token punctuation\">{</span>\n        println android<span class=\"token operator\">.</span>defaultConfig<span class=\"token operator\">.</span>versionName\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now when you run <code class=\"language-text\">./gradlew :app:printVersionName</code>, your version name should be printed in the console. Now all we have to do is use this in our deployment.</p>\n<p>Just as there is a <code class=\"language-text\">before_install</code> section of our <code class=\"language-text\">.travis.yml</code>, there is also a <code class=\"language-text\">before_deploy</code>. As such, we can add the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">before_deploy</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> export APP_VERSION=$(./gradlew <span class=\"token punctuation\">:</span>app<span class=\"token punctuation\">:</span>printVersionName)</code></pre></div>\n<p>This creates an environment variable (\"APP_VERSION\") containing our app's version name, which we can then reference from the actual deployment as follows...</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">provider</span><span class=\"token punctuation\">:</span> releases\n    <span class=\"token key atrule\">api_key</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"$GITHUB_TOKEN\"</span>\n    <span class=\"token key atrule\">file</span><span class=\"token punctuation\">:</span> app/build/outputs/apk/release/*\n    <span class=\"token key atrule\">file_glob</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">skip_cleanup</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">overwrite</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"$APP_VERSION\"</span>\n    <span class=\"token key atrule\">tag_name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"$APP_VERSION\"</span>\n    <span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">branch</span><span class=\"token punctuation\">:</span> master</code></pre></div>\n<p>Yay! Now we have fully automated releases on each push to master. Because of the <code class=\"language-text\">overwrite</code> parameter, it will overwrite existing releases if the version number has not been changed (a new release will be created if it has), so they will always be up to date.</p>\n<h2 id=\"Step-4-Deploying-to-the-Play-Store\"><a href=\"#Step-4-Deploying-to-the-Play-Store\" aria-label=\"Step 4 Deploying to the Play Store permalink\" class=\"anchor\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 36 36\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8.10021 27.8995C6.14759 25.9469 6.14759 22.7811 8.10021 20.8284L12.6964 16.2322C14.4538 14.4749 17.303 14.4749 19.0604 16.2322L20.121 17.2929C20.7068 17.8787 21.6566 17.8787 22.2423 17.2929C22.8281 16.7071 22.8281 15.7574 22.2423 15.1716L21.1817 14.1109C18.2528 11.182 13.504 11.182 10.5751 14.1109L5.97889 18.7071C2.85469 21.8313 2.85469 26.8966 5.97889 30.0208C9.10308 33.145 14.1684 33.145 17.2926 30.0208L18.3533 28.9602C18.939 28.3744 18.939 27.4246 18.3533 26.8388C17.7675 26.2531 16.8177 26.2531 16.2319 26.8388L15.1713 27.8995C13.2187 29.8521 10.0528 29.8521 8.10021 27.8995Z\" fill=\"#153E67\"/><path d=\"M27.8992 8.10051C29.8518 10.0531 29.8518 13.219 27.8992 15.1716L23.303 19.7678C21.5456 21.5251 18.6964 21.5251 16.939 19.7678L15.8784 18.7071C15.2926 18.1213 14.3428 18.1213 13.7571 18.7071C13.1713 19.2929 13.1713 20.2426 13.7571 20.8284L14.8177 21.8891C17.7467 24.818 22.4954 24.818 25.4243 21.8891L30.0205 17.2929C33.1447 14.1687 33.1447 9.10339 30.0205 5.97919C26.8963 2.855 21.831 2.855 18.7068 5.97919L17.6461 7.03985C17.0604 7.62564 17.0604 8.57539 17.6461 9.16117C18.2319 9.74696 19.1817 9.74696 19.7675 9.16117L20.8281 8.10051C22.7808 6.14789 25.9466 6.14789 27.8992 8.10051Z\" fill=\"#153E67\"/></svg></a>Step 4. Deploying to the Play Store</h2>\n<p>Travis doesn't have a deployment for the Play Store, so we will have to use a third party tool. I found <a href=\"https://github.com/Triple-T/gradle-play-publisher/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Triple-T/gradle-play-publisher</a>, which should work, except there isn't an option to deploy an existing APK without building the project. Not only would a deployment that requires building a project <em>twice</em> be super wasteful and take... well, twice as long, <a href=\"https://jfenn.me/redirects/?t=twitter&#x26;d=status/1061620100409761792\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">I ran into problems signing the APK</a> when I tried it, so... let's not. Instead, we'll modify the <code class=\"language-text\">script</code> to run the <code class=\"language-text\">./gradlew publish</code> command when a build is triggered from the master branch.</p>\n<h3 id=\"Part-A-Setup\"><a href=\"#Part-A-Setup\" aria-label=\"Part A Setup permalink\" class=\"anchor\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 36 36\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8.10021 27.8995C6.14759 25.9469 6.14759 22.7811 8.10021 20.8284L12.6964 16.2322C14.4538 14.4749 17.303 14.4749 19.0604 16.2322L20.121 17.2929C20.7068 17.8787 21.6566 17.8787 22.2423 17.2929C22.8281 16.7071 22.8281 15.7574 22.2423 15.1716L21.1817 14.1109C18.2528 11.182 13.504 11.182 10.5751 14.1109L5.97889 18.7071C2.85469 21.8313 2.85469 26.8966 5.97889 30.0208C9.10308 33.145 14.1684 33.145 17.2926 30.0208L18.3533 28.9602C18.939 28.3744 18.939 27.4246 18.3533 26.8388C17.7675 26.2531 16.8177 26.2531 16.2319 26.8388L15.1713 27.8995C13.2187 29.8521 10.0528 29.8521 8.10021 27.8995Z\" fill=\"#153E67\"/><path d=\"M27.8992 8.10051C29.8518 10.0531 29.8518 13.219 27.8992 15.1716L23.303 19.7678C21.5456 21.5251 18.6964 21.5251 16.939 19.7678L15.8784 18.7071C15.2926 18.1213 14.3428 18.1213 13.7571 18.7071C13.1713 19.2929 13.1713 20.2426 13.7571 20.8284L14.8177 21.8891C17.7467 24.818 22.4954 24.818 25.4243 21.8891L30.0205 17.2929C33.1447 14.1687 33.1447 9.10339 30.0205 5.97919C26.8963 2.855 21.831 2.855 18.7068 5.97919L17.6461 7.03985C17.0604 7.62564 17.0604 8.57539 17.6461 9.16117C18.2319 9.74696 19.1817 9.74696 19.7675 9.16117L20.8281 8.10051C22.7808 6.14789 25.9466 6.14789 27.8992 8.10051Z\" fill=\"#153E67\"/></svg></a>Part A. Setup</h3>\n<p>Setup is fairly simple; just follow the directions in the plugin's readme. However, what should we do with the JSON file? PLEASE DO NOT ADD IT TO GIT. ANYONE WITH THIS FILE HAS ACCESS TO YOUR PLAY CONSOLE. WE'RE ENCRYPTING IT.</p>\n<p>You can either encrypt it as a separate file, or you can put them both in a tar (<code class=\"language-text\">tar -cvf secrets.tar key.jks service.json</code>), encrypt that, and run <code class=\"language-text\">tar -xvf secrets.tar</code> once it has been decrypted. I am not sure if either will affect how secure they are. I have opted for the tar method as it gives me less things to keep track of.</p>\n<h3 id=\"Part-B-Publishing\"><a href=\"#Part-B-Publishing\" aria-label=\"Part B Publishing permalink\" class=\"anchor\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 36 36\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8.10021 27.8995C6.14759 25.9469 6.14759 22.7811 8.10021 20.8284L12.6964 16.2322C14.4538 14.4749 17.303 14.4749 19.0604 16.2322L20.121 17.2929C20.7068 17.8787 21.6566 17.8787 22.2423 17.2929C22.8281 16.7071 22.8281 15.7574 22.2423 15.1716L21.1817 14.1109C18.2528 11.182 13.504 11.182 10.5751 14.1109L5.97889 18.7071C2.85469 21.8313 2.85469 26.8966 5.97889 30.0208C9.10308 33.145 14.1684 33.145 17.2926 30.0208L18.3533 28.9602C18.939 28.3744 18.939 27.4246 18.3533 26.8388C17.7675 26.2531 16.8177 26.2531 16.2319 26.8388L15.1713 27.8995C13.2187 29.8521 10.0528 29.8521 8.10021 27.8995Z\" fill=\"#153E67\"/><path d=\"M27.8992 8.10051C29.8518 10.0531 29.8518 13.219 27.8992 15.1716L23.303 19.7678C21.5456 21.5251 18.6964 21.5251 16.939 19.7678L15.8784 18.7071C15.2926 18.1213 14.3428 18.1213 13.7571 18.7071C13.1713 19.2929 13.1713 20.2426 13.7571 20.8284L14.8177 21.8891C17.7467 24.818 22.4954 24.818 25.4243 21.8891L30.0205 17.2929C33.1447 14.1687 33.1447 9.10339 30.0205 5.97919C26.8963 2.855 21.831 2.855 18.7068 5.97919L17.6461 7.03985C17.0604 7.62564 17.0604 8.57539 17.6461 9.16117C18.2319 9.74696 19.1817 9.74696 19.7675 9.16117L20.8281 8.10051C22.7808 6.14789 25.9466 6.14789 27.8992 8.10051Z\" fill=\"#153E67\"/></svg></a>Part B. Publishing</h3>\n<p>Now we can modify the <code class=\"language-text\">script</code> section of our <code class=\"language-text\">.travis.yml</code> to run the <code class=\"language-text\">./gradlew publish</code> command when a build is triggered from the master branch. This can be done using the \"TRAVIS_BRANCH\" environment variable which Travis handily creates for us. In other words...</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> if <span class=\"token punctuation\">[</span> \"$TRAVIS_BRANCH\" = \"master\" <span class=\"token punctuation\">]</span>; then ./gradlew publish; else ./gradlew build; fi</code></pre></div>\n<p>This should build a signed APK and upload it to the Play Store whenever a push is made to the <code class=\"language-text\">master</code> branch, then deploy the same APK to GitHub if it was built successfully. Important to note that using this method, the build will also fail if it has failed to upload the APK to the Play Store - so it <em>might</em> not be an issue with your project if it results in a failure unexpectedly.</p>\n<h3 id=\"Part-C-Changelogs\"><a href=\"#Part-C-Changelogs\" aria-label=\"Part C Changelogs permalink\" class=\"anchor\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 36 36\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8.10021 27.8995C6.14759 25.9469 6.14759 22.7811 8.10021 20.8284L12.6964 16.2322C14.4538 14.4749 17.303 14.4749 19.0604 16.2322L20.121 17.2929C20.7068 17.8787 21.6566 17.8787 22.2423 17.2929C22.8281 16.7071 22.8281 15.7574 22.2423 15.1716L21.1817 14.1109C18.2528 11.182 13.504 11.182 10.5751 14.1109L5.97889 18.7071C2.85469 21.8313 2.85469 26.8966 5.97889 30.0208C9.10308 33.145 14.1684 33.145 17.2926 30.0208L18.3533 28.9602C18.939 28.3744 18.939 27.4246 18.3533 26.8388C17.7675 26.2531 16.8177 26.2531 16.2319 26.8388L15.1713 27.8995C13.2187 29.8521 10.0528 29.8521 8.10021 27.8995Z\" fill=\"#153E67\"/><path d=\"M27.8992 8.10051C29.8518 10.0531 29.8518 13.219 27.8992 15.1716L23.303 19.7678C21.5456 21.5251 18.6964 21.5251 16.939 19.7678L15.8784 18.7071C15.2926 18.1213 14.3428 18.1213 13.7571 18.7071C13.1713 19.2929 13.1713 20.2426 13.7571 20.8284L14.8177 21.8891C17.7467 24.818 22.4954 24.818 25.4243 21.8891L30.0205 17.2929C33.1447 14.1687 33.1447 9.10339 30.0205 5.97919C26.8963 2.855 21.831 2.855 18.7068 5.97919L17.6461 7.03985C17.0604 7.62564 17.0604 8.57539 17.6461 9.16117C18.2319 9.74696 19.1817 9.74696 19.7675 9.16117L20.8281 8.10051C22.7808 6.14789 25.9466 6.14789 27.8992 8.10051Z\" fill=\"#153E67\"/></svg></a>Part C. Changelogs</h3>\n<p>Now, gradle-play-publisher requires you to specify a changelog at <code class=\"language-text\">app/src/main/play/release-notes/en-US/default.txt</code> for it to publish an APK. What if we want to use the same changelog for GitHub releases? We'll add another line to the <code class=\"language-text\">before_deploy</code> section and GitHub deployment to do so.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">before_deploy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">...</span>\n  <span class=\"token punctuation\">-</span> export APP_CHANGELOG=$(cat app/src/main/play/release<span class=\"token punctuation\">-</span>notes/en<span class=\"token punctuation\">-</span>US/default.txt)\n<span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">provider</span><span class=\"token punctuation\">:</span> releases\n    <span class=\"token punctuation\">...</span>\n    <span class=\"token key atrule\">body</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"$APP_CHANGELOG\"</span></code></pre></div>\n<h2 id=\"Finish\"><a href=\"#Finish\" aria-label=\"Finish permalink\" class=\"anchor\"><svg width=\"20\" height=\"20\" viewBox=\"0 0 36 36\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8.10021 27.8995C6.14759 25.9469 6.14759 22.7811 8.10021 20.8284L12.6964 16.2322C14.4538 14.4749 17.303 14.4749 19.0604 16.2322L20.121 17.2929C20.7068 17.8787 21.6566 17.8787 22.2423 17.2929C22.8281 16.7071 22.8281 15.7574 22.2423 15.1716L21.1817 14.1109C18.2528 11.182 13.504 11.182 10.5751 14.1109L5.97889 18.7071C2.85469 21.8313 2.85469 26.8966 5.97889 30.0208C9.10308 33.145 14.1684 33.145 17.2926 30.0208L18.3533 28.9602C18.939 28.3744 18.939 27.4246 18.3533 26.8388C17.7675 26.2531 16.8177 26.2531 16.2319 26.8388L15.1713 27.8995C13.2187 29.8521 10.0528 29.8521 8.10021 27.8995Z\" fill=\"#153E67\"/><path d=\"M27.8992 8.10051C29.8518 10.0531 29.8518 13.219 27.8992 15.1716L23.303 19.7678C21.5456 21.5251 18.6964 21.5251 16.939 19.7678L15.8784 18.7071C15.2926 18.1213 14.3428 18.1213 13.7571 18.7071C13.1713 19.2929 13.1713 20.2426 13.7571 20.8284L14.8177 21.8891C17.7467 24.818 22.4954 24.818 25.4243 21.8891L30.0205 17.2929C33.1447 14.1687 33.1447 9.10339 30.0205 5.97919C26.8963 2.855 21.831 2.855 18.7068 5.97919L17.6461 7.03985C17.0604 7.62564 17.0604 8.57539 17.6461 9.16117C18.2319 9.74696 19.1817 9.74696 19.7675 9.16117L20.8281 8.10051C22.7808 6.14789 25.9466 6.14789 27.8992 8.10051Z\" fill=\"#153E67\"/></svg></a>Finish</h2>\n<p>Hopefully this blog has gone over the basics of using Travis to deploy to GitHub and the Play Store. In later blogs, I hope to also cover how to implement UI and Unit tests, though I have yet to actually use them myself so I cannot yet write an article about them.</p>\n<p>If you would like to see a working example of all of this, you can find it in a sample project <a href=\"https://jfenn.me/redirects/?t=github&#x26;d=TravisAndroidExample\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a>.</p>","frontmatter":{"title":"Continuous Integration with Travis CI for Android","published":"August 22, 2019","tags":["android","ci"],"description":"An in-depth tutorial explaining how to set up Travis CI to deploy signed builds to Google Play. Among other things","authors":[{"name":"James Fenn","id":"fennifith","description":"Enjoys writing software on loud keyboards. Starts too many projects. Consumes food.","color":"#0091EA","fields":{"isAuthor":true},"roles":[{"prettyname":"Developer","id":"developer"}],"socials":{"twitter":"fennifith","github":"fennifith","website":null},"pronouns":{"they":"he","them":"him","their":"his","theirs":"his","themselves":"himself"},"profileImg":{"childImageSharp":{"smallPic":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAQCBQP/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB9a4s2dtCl4+QsB//xAAdEAACAgEFAAAAAAAAAAAAAAABAgADEgQREyEx/9oACAEBAAEFAupp7QwhUKtVmM5GljEuPN8l/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAHRAAAgIBBQAAAAAAAAAAAAAAAAEQEVECEiExsf/aAAgBAQAGPwI2001HPpeTocaW8H//xAAcEAEBAAICAwAAAAAAAAAAAAABABEhMUFhcfD/2gAIAQEAAT8hUCvBdww33LNEYPEE9HQb5Flx0ahlHuz55f/aAAwDAQACAAMAAAAQVACA/8QAFREBAQAAAAAAAAAAAAAAAAAAASD/2gAIAQMBAT8QAI//xAAVEQEBAAAAAAAAAAAAAAAAAAABIP/aAAgBAgEBPxBVj//EABoQAQADAQEBAAAAAAAAAAAAAAEAESExQYH/2gAIAQEAAT8QAMoti0hKB4Xs3mDr49fBhSwhZzPIvSWEx9QBuSh4EJe643mXktBwFPdZ/9k=","width":60,"height":60,"src":"/static/08b6f7fd29f46f215a6feff79d53bc2c/d0cbf/fennifith.jpg","srcSet":"/static/08b6f7fd29f46f215a6feff79d53bc2c/d0cbf/fennifith.jpg 1x,\n/static/08b6f7fd29f46f215a6feff79d53bc2c/e451c/fennifith.jpg 1.5x,\n/static/08b6f7fd29f46f215a6feff79d53bc2c/d7d1f/fennifith.jpg 2x"},"mediumPic":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAQCBQP/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB9a4s2dtCl4+QsB//xAAdEAACAgEFAAAAAAAAAAAAAAABAgADEgQREyEx/9oACAEBAAEFAupp7QwhUKtVmM5GljEuPN8l/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAHRAAAgIBBQAAAAAAAAAAAAAAAAEQEVECEiExsf/aAAgBAQAGPwI2001HPpeTocaW8H//xAAcEAEBAAICAwAAAAAAAAAAAAABABEhMUFhcfD/2gAIAQEAAT8hUCvBdww33LNEYPEE9HQb5Flx0ahlHuz55f/aAAwDAQACAAMAAAAQVACA/8QAFREBAQAAAAAAAAAAAAAAAAAAASD/2gAIAQMBAT8QAI//xAAVEQEBAAAAAAAAAAAAAAAAAAABIP/aAAgBAgEBPxBVj//EABoQAQADAQEBAAAAAAAAAAAAAAEAESExQYH/2gAIAQEAAT8QAMoti0hKB4Xs3mDr49fBhSwhZzPIvSWEx9QBuSh4EJe643mXktBwFPdZ/9k=","width":85,"height":85,"src":"/static/08b6f7fd29f46f215a6feff79d53bc2c/0b0b2/fennifith.jpg","srcSet":"/static/08b6f7fd29f46f215a6feff79d53bc2c/0b0b2/fennifith.jpg 1x,\n/static/08b6f7fd29f46f215a6feff79d53bc2c/63ff1/fennifith.jpg 1.5x,\n/static/08b6f7fd29f46f215a6feff79d53bc2c/51c99/fennifith.jpg 2x"},"bigPic":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAQCBQP/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB9a4s2dtCl4+QsB//xAAdEAACAgEFAAAAAAAAAAAAAAABAgADEgQREyEx/9oACAEBAAEFAupp7QwhUKtVmM5GljEuPN8l/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAHRAAAgIBBQAAAAAAAAAAAAAAAAEQEVECEiExsf/aAAgBAQAGPwI2001HPpeTocaW8H//xAAcEAEBAAICAwAAAAAAAAAAAAABABEhMUFhcfD/2gAIAQEAAT8hUCvBdww33LNEYPEE9HQb5Flx0ahlHuz55f/aAAwDAQACAAMAAAAQVACA/8QAFREBAQAAAAAAAAAAAAAAAAAAASD/2gAIAQMBAT8QAI//xAAVEQEBAAAAAAAAAAAAAAAAAAABIP/aAAgBAgEBPxBVj//EABoQAQADAQEBAAAAAAAAAAAAAAEAESExQYH/2gAIAQEAAT8QAMoti0hKB4Xs3mDr49fBhSwhZzPIvSWEx9QBuSh4EJe643mXktBwFPdZ/9k=","width":300,"height":300,"src":"/static/08b6f7fd29f46f215a6feff79d53bc2c/79638/fennifith.jpg","srcSet":"/static/08b6f7fd29f46f215a6feff79d53bc2c/79638/fennifith.jpg 1x"}}}}],"license":{"licenceType":"Public Domain","footerImg":"https://licensebuttons.net/p/zero/1.0/88x31.png","explainLink":"https://creativecommons.org/publicdomain/zero/1.0/","name":"CC0 1.0 Universal (CC0 1.0) Public Domain Dedication","displayName":"Public Domain"}},"fields":{"slug":"/travis-ci-for-android/"},"wordCount":{"words":2310}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/travis-ci-for-android/","previous":{"fields":{"slug":"/uttering-hello-introduction-post/"},"frontmatter":{"title":"Uttering Hello â€” The Site's First Post","authors":[{"id":"crutchcorn"}]}},"next":{"fields":{"slug":"/typescript-type-generics/"},"frontmatter":{"title":"TypeScript Intermediates - Type Generics","authors":[{"id":"crutchcorn"}]}}}}}